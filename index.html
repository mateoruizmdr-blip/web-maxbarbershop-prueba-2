<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max Studio Barber Shop</title>
    <meta name="description" content="Barbería moderna en Madrid. Estilo, precisión y actitud. Reserva tu cita online.">
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css?v=1.1">
</head>

    <body>
      <script>  
     window.onload = function() {
    const urlReserva = "https://unstormable-trothless-gilberto.ngrok-free.dev/webhook-test/eee10825-ff7e-4622-8ba9-37596ffd9745";
    const urlConsulta = "https://unstormable-trothless-gilberto.ngrok-free.dev/webhook-test/ec2331d9-fca8-482b-920e-aedce6dfc718";

    const formElement = document.getElementById('bookingForm');
    const dateInput = document.getElementById('date');
    const employeeInput = document.getElementById('employee');
    const serviceSelect = document.getElementById('service');
    const timeSelect = document.getElementById('time');

    // Función para consultar disponibilidad real
    async function consultarDisponibilidad() {
        const fecha = dateInput.value;
        const barbero = employeeInput.value;
        const servicioOption = serviceSelect.options[serviceSelect.selectedIndex];
        const duracionReserva = parseInt(servicioOption.getAttribute('data-duration'));

        if (!fecha || !barbero || !duracionReserva) return;

        timeSelect.innerHTML = '<option>Consultando agenda...</option>';
        timeSelect.disabled = true;

        try {
            const res = await fetch(urlConsulta, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ fecha, barbero })
            });

            if (res.ok) {
                const eventosOcupados = await res.json(); // n8n devuelve [{start: "HH:mm", end: "HH:mm"}, ...]
                generarHorariosDisponibles(eventosOcupados, duracionReserva);
            }
        } catch (err) {
            console.error("Error:", err);
            timeSelect.innerHTML = '<option>Error al cargar horas</option>';
        }
    }

    function generarHorariosDisponibles(ocupados, duracionSolicitada) {
        timeSelect.innerHTML = '<option value="" disabled selected>Elige una hora</option>';
        
        // Generamos tramos cada 15 minutos (puedes ajustarlo a 10 si prefieres)
        for (let h = 11; h < 21; h++) {
            for (let m = 0; m < 60; m += 15) {
                let hh = h.toString().padStart(2, '0');
                let mm = m.toString().padStart(2, '0');
                let horaInicio = `${hh}:${mm}`;
                
                // Calculamos cuándo terminaría esta cita si empezara aquí
                let dateInicio = new Date(`2000-01-01T${horaInicio}`);
                let dateFin = new Date(dateInicio.getTime() + duracionSolicitada * 60000);
                let horaFin = dateFin.toTimeString().substring(0, 5);

                // Verificamos si este bloque choca con alguna cita de Google Calendar
                const choca = ocupados.some(evento => {
                    return (horaInicio < evento.end && horaFin > evento.start);
                });

                if (!choca) {
                    let option = document.createElement('option');
                    option.value = horaInicio;
                    option.textContent = horaInicio;
                    timeSelect.appendChild(option);
                }
            }
        }
        timeSelect.disabled = false;
    }

    // Eventos para disparar la consulta
    dateInput.onchange = consultarDisponibilidad;
    employeeInput.onchange = consultarDisponibilidad;
    serviceSelect.onchange = consultarDisponibilidad;

    // Lógica de envío (la que ya tenías)
    if (formElement) {
        formElement.onsubmit = async (e) => {
            e.preventDefault();
            const datosCita = {
                nombre: document.getElementById('name').value,
                email: document.getElementById('email').value,
                barbero: document.getElementById('employee').value,
                servicio: serviceSelect.options[serviceSelect.selectedIndex].text,
                duracion: serviceSelect.options[serviceSelect.selectedIndex].getAttribute('data-duration'),
                fecha: dateInput.value,
                hora: timeSelect.value
            };

            try {
                const res = await fetch(urlReserva, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datosCita)
                });
                if (res.ok) alert("¡Cita reservada!");
            } catch (err) {
                alert("Error al enviar");
            }
        };
    }
};
         <script>
             
    <!-- Header / Navigation -->
    <header id="header">
        <div class="container">
            <div class="logo">
                <h1>MAX STUDIO</h1>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#home">Inicio</a></li>
                    <li><a href="#booking">Reservar</a></li>
                    <li><a href="#gallery">Galería</a></li>
                    <li><a href="#location">Ubicación</a></li>
                </ul>
                <div class="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <span class="close-menu"><i class="fas fa-times"></i></span>
        <ul>
            <li><a href="#home">Inicio</a></li>
            <li><a href="#booking">Reservar</a></li>
            <li><a href="#gallery">Galería</a></li>
            <li><a href="#location">Ubicación</a></li>
        </ul>
    </div>

    <!-- Home Section -->
    <section id="home">
        <div class="hero-bg"></div>
        <div class="overlay"></div>
        <div class="hero-content">
            <h2>MAX STUDIO BARBER SHOP</h2>
            <p class="slogan">ESTILO, PRECISIÓN Y ACTITUD</p>
            <a href="#booking" class="btn-gold">Reservar Cita <i class="fas fa-arrow-right"></i></a>
        </div>
    </section>

    <!-- Booking Section -->
    <section id="booking">
        <div class="container">
            <h2 class="section-title">RESERVA TU CITA</h2>
            <div class="booking-wrapper">

                <!-- Booking Form -->
                <div class="booking-form-container">
                    <h3>Nueva Reserva</h3>
                    <form id="bookingForm">
                        <div class="form-group">
                            <label for="name">Nombre Completo</label>
                            <input type="text" id="name" name="name" required placeholder="Tu nombre">
                        </div>
                        <div class="form-group">
                            <label for="email">Correo Electrónico</label>
                            <input type="email" id="email" name="email" required placeholder="tu@email.com">
                        </div>
                        <div class="form-group">
                            <label for="employee">Selecciona Barbero</label>
                            <select id="employee" name="employee" required>
                                <option value="Cualquiera">Cualquiera</option>
                                <option value="Ayoub">Ayoub</option>
                                <option value="Ragnar Ab">Ragnar Ab</option>
                                <option value="Yasin">Yasin</option>
                                <option value="Alejandro">Alejandro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="service">Servicio</label>
                            <select id="service" name="service" required>
                                <option value="" disabled selected>Elige un servicio</option>
                                <option value="11" data-duration="30">Corte de pelo - 11€ (30 min)</option>
                                <option value="16" data-duration="40">Cortar y barba - 16€ (40 min)</option>
                                <option value="6" data-duration="15">Corte de barba - 6€ (15 min)</option>
                                <option value="8" data-duration="20">Jubilados - 8€ (20 min)</option>
                                <option value="3" data-duration="10">Cejas - 3€ (10 min)</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label for="date">Fecha</label>
                                <input type="date" id="date" name="date" required>
                            </div>
                            <div class="form-group half">
                                <label for="time">Hora</label>
                                <select id="time" name="time" required disabled>
                                    <option value="">Selecciona servicio y fecha primero</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn-gold full-width">CONFIRMAR RESERVA</button>
                    </form>
                    <div id="bookingMessage" class="message"></div>
                </div>

                <!-- Cancel Booking -->
                <div class="cancel-booking-container">
                    <h3>Cancelar Reserva</h3>
                    <form id="cancelForm">
                        <div class="form-group">
                            <label for="cancelEmail">Correo de la reserva</label>
                            <input type="email" id="cancelEmail" name="cancelEmail" required
                                placeholder="Email usado en la reserva">
                        </div>
                        <button type="submit" class="btn-outline">CANCELAR CITA</button>
                    </form>
                    <div id="cancelMessage" class="message"></div>
                </div>

            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery">
        <div class="container">
            <h2 class="section-title">NUESTRO TRABAJO</h2>
            <div class="gallery-grid">
                <!-- Images from folder -->
                <!-- gallery content -->
                <div class="gallery-item"><img
                        src="assets/img/gallery/614854445_806688182423603_6381585991481972604_n.jpg" alt="Corte 1">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/614886055_911359418128691_6870970335472322327_n.jpg" alt="Corte 2">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/615047851_911313978132025_7686383220628662739_n.jpg" alt="Corte 3">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/615051952_1601498341006170_7528876136289270963_n.jpg" alt="Corte 4">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/617517021_1430504608639657_1068881685685668652_n.jpg" alt="Corte 5">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/618337475_1791124541579999_4100679849414398982_n.jpg" alt="Corte 6">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/619596011_4516614841895806_7695458174893846566_n.jpg" alt="Corte 7">
                </div>
                <div class="gallery-item"><img
                        src="assets/img/gallery/620013243_1321186406432520_1798237511895044667_n.jpg" alt="Corte 8">
                </div>
            </div>
        </div>
    </section>

    <!-- Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 id="modalTitle">Título</h3>
            <p id="modalMessage">Mensaje aquí</p>
            <button class="btn-gold" id="closeModalBtn">Aceptar</button>
        </div>
    </div>

    <!-- Location Section -->
    <section id="location">
        <div class="container">
            <h2 class="section-title">UBICACIÓN</h2>
            <div class="location-content">
                <div class="map-container">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3038.567634629457!2d-3.6300000!3d40.3950000!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd4225c5d0e2e5cd%3A0x1234567890abcdef!2sBulevar%20de%20Indalecio%20Prieto%2C%2044%2C%2028032%20Madrid!5e0!3m2!1ses!2ses!4v1642680000000!5m2!1ses!2ses"
                        width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy">
                    </iframe>
                </div>
                <div class="address-box">
                    <i class="fas fa-map-marker-alt"></i>
                    <p>Bulevar de Indalecio Prieto, 44, Local 2,<br>28032, Madrid</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>MAX STUDIO</h3>
                    <p>La mejor experiencia de barbería en Madrid.</p>
                </div>
                <div class="footer-col">
                    <h3>CONTACTO</h3>
                    <p><i class="fas fa-phone"></i> +34 123 456 789</p> <!-- Placeholder phone -->
                    <p><i class="fas fa-envelope"></i> info@maxstudio.com</p>
                </div>
                <div class="footer-col">
                    <h3>HORARIO</h3>
                    <p>Lunes - Sábado: 11:00 - 21:00</p>
                    <p>Domingo: Cerrado</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Max Studio Barber Shop. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
</body>

</html>
